<!DOCTYPE html>
<html>
    <head>
        <title>Umbrella Bot Server</title>
        <link rel="stylesheet" href="main.css" type="text/css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="libcanvas.js"></script>
        <script src="app.js"></script>
        <script>
            $(function () {
                var app = new App('ws://' + window.location.host + '/sc');
                if (!app.isBrowserSupported()) {
                    return;
                }
                app.onlocalmedia = function (stream) {
                    var srcObj = stream;
                    if (typeof(webkitURL) === 'function') {
                        srcObj = webkitURL.createObjectURL(stream);
                    }
                    var me =  document.getElementById('me');
                    me.src = srcObj;
                    me.play();
                    
                    var met = document.getElementById('met');
                    var ctx = met.getContext('2d');
                    met.width = me.clientWidth;
                    met.height = me.clientHeight;

                    // initialize requestAnimationFrame method
                    window.requestAnimationFrame || (window.requestAnimationFrame = window.webkitRequestAnimationFrame || function (clb) { window.setTimeout (clb, 1000 / 60) });
                    function drawFrame() {
                        window.requestAnimationFrame(drawFrame);
                        ctx.drawImage(me, 0, 0, met.width, met.height);
                    }
                    drawFrame();
                };
                rc.connect();
            });
        </script>
    </head>
    <body>
        <h3>Video stream</h3>
        <video id="me" autoplay="true"></video>
        <h3>Video canvas</h3>
        <canvas id="met"></canvas>
    </body>
</html>
